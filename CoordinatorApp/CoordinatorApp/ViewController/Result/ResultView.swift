//
//  ResultView.swift
//  CoordinatorApp
//
//  Created by NEMSOTHEA on 2/20/25.
//

import SwiftUI

struct ResultView: View {

    // MARK: - Properties
    var result: [String]
    var wrongAnswerArray: [ReadingQuestionModel.Question]

    // MARK: - Body
    var body: some View {
        GeometryReader { _ in
            VStack(alignment: .center){
                // Header Section
                HeaderView(result: result)
                
                ScrollView {
                    VStack(alignment: .center) {
                      
                        // Collection View (using List in SwiftUI)
                        if !wrongAnswerArray.isEmpty {
                            WrongAnswersListView(wrongAnswerArray: wrongAnswerArray)
    //                            .frame(height: 400) // Adjust height as needed
                                .frame(height: .infinity)
                        }
                        else{
                            EmptyView()
                            
                        }

                     
                    }
                    .padding()
                }
                // Home Button
                HomeButton()
            }
           

            .navigationBarHidden(true)  // Hide the default navigation bar if you had one
        }
        
    }
}
// MARK: - Helper Views

struct HeaderView: View {
    var result: [String]
    let fontSize = Share.shared.setFontSize() // Assuming you have a similar function in SwiftUI


    var body: some View {
        VStack(alignment: .center, spacing: 10) {
            
                Text("Congratulations ü•∞ü•≥üéäüéâ")
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize)) // Use .custom for custom fonts
                    .frame(height: 50)
           

            Text("You have reached \(result[0]) of \(result[1]) question(s), \(result[2])")
                .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                .multilineTextAlignment(.center) // Center align multiline text
        }
    }
}

struct ReCheckLabel: View {
     let fontSize = Share.shared.setFontSize()

    var body: some View {
        Text("Îã§Ïãú ÌôïÏù∏")
            .font(.custom("1HoonDdukbokki Regular", size: fontSize))
            .padding(.top)
    }
}

struct WrongAnswersListView: View {
    var wrongAnswerArray: [ReadingQuestionModel.Question]
    let isiPad  = UIDevice.current.userInterfaceIdiom == .pad
    
    var body: some View {
        ScrollView(.vertical) { // Use ScrollView for horizontal scrolling
            LazyVStack(spacing: 0) {  // Use LazyHStack for performance with large lists.  Spacings is 0.
                ForEach(wrongAnswerArray.indices, id: \.self) { index in
                    if wrongAnswerArray[index].isImg == "y" {
                        if isiPad {
                            ResultImageiPadCellView(question: wrongAnswerArray[index])
                                .frame(width: UIScreen.main.bounds.width) // Set width to screen width.
                           
                        }else {
                            ResultImageiPhoneCellView(question: wrongAnswerArray[index])
                                .frame(width: UIScreen.main.bounds.width) // Set width to screen width.
                        }
                        
                    }else {
                        if isiPad {
                            ResultTextiPadCellView(question: wrongAnswerArray[index])
                                .frame(width: UIScreen.main.bounds.width) // Set width to screen width.
                        }else {
                            ResultTextiPhoneCellView(question: wrongAnswerArray[index])
                                .frame(width: UIScreen.main.bounds.width) // Set width to screen width.
                        }
                        
                    }
                    
                }
            }
        }
    }
}

// MARK: - ResultImageiPadCellView
struct ResultImageiPadCellView: View {
    
    let question: ReadingQuestionModel.Question
    let fontSize        = Share.shared.setFontSize()
    let setLineSpacing  = Share.shared.setLineSpacing()
    
    var body: some View {
        // Customize this based on your ResultCollectionViewCell's UI
        VStack(alignment: .leading, spacing: 10) {
            
            Text("\( question.sections)")
                .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                .font(.headline)
                .padding()
            Image(question.question)
                .resizable()
                .scaledToFit()
                .frame(width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height / 2 - 30)

            VStack(alignment: .leading,spacing: setLineSpacing) {
                Text("\(question.option_1)") // Display user's answer (handle optional)
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                Text("\(question.option_2)") // Display user's answer (handle optional)
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                Text("\(question.option_3)") // Display user's answer (handle optional)
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                Text("\(question.option_4)") // Display user's answer (handle optional)
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize))
               
                Text("Correct Answer : \(question.correctAnswer ?? "")")
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                    .font(.headline)
                    .foregroundStyle(.red)
            }
            .padding()
            
        }
        .padding(.leading)
        .background(Color.gray.opacity(0.1)) // Light background
        .cornerRadius(10)
        .padding(.horizontal)
    }
}

//MARK: - ResultImageiPhoneCellView
struct ResultImageiPhoneCellView: View {
    
    let question        : ReadingQuestionModel.Question
    let fontSize        = Share.shared.setFontSize()
    let setLineSpacing  = Share.shared.setLineSpacing()
 
    
    var body: some View {
        VStack(alignment: .leading, spacing: setLineSpacing) { // Use a single VStack
            Text("\(question.sections)")
                .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                .font(.headline)
            
            Image(question.question) // Assuming question.question is the image name
                .resizable()
                .scaledToFit()
                .frame(maxWidth: .infinity) // Use maxWidth: .infinity
                .padding(.bottom, setLineSpacing)  //Add Some Space
            
            VStack(alignment: .leading, spacing: setLineSpacing) {
                Text("\(question.option_1)")
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                Text("\(question.option_2)")
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                Text("\(question.option_3)")
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                Text("\(question.option_4)")
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                
                Text("Correct Answer : \(question.correctAnswer ?? "")")
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                    .font(.headline)
                    .foregroundStyle(.red)
            }
            
            
            
        }
        .padding() // Apply padding to the entire VStack
        .background(Color.gray.opacity(0.1))
        .cornerRadius(10)
        .padding(.horizontal)
    }
}

// MARK: - ResultTextiPhoneCellView

struct ResultTextiPhoneCellView: View {
    
    let question        : ReadingQuestionModel.Question
    let fontSize        = Share.shared.setFontSize()
    let setLineSpacing  = Share.shared.setLineSpacing()
    
     var body: some View {
         // Customize this based on your ResultCollectionViewCell's UI
         VStack(alignment: .leading, spacing: 10) {
             Text("\( question.sections)")
                 .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                 .font(.headline)
                 .padding(.bottom)
        
             Text("\( question.question)") // Replace with actual question text
                 .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                 .font(.headline)
                 .lineLimit(nil)
                 .lineSpacing(setLineSpacing)
                 .frame(maxWidth: .infinity, maxHeight: .infinity, alignment: .leading)
                 .padding(.bottom)
             VStack(alignment: .leading,spacing: setLineSpacing) {
                 Text("\(question.option_1)") // Display user's answer (handle optional)
                     .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                 Text("\(question.option_2)") // Display user's answer (handle optional)
                     .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                 Text("\(question.option_3)") // Display user's answer (handle optional)
                     .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                 Text("\(question.option_4)") // Display user's answer (handle optional)
                     .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                     .padding(.bottom)
                 Text("Correct Answer : \(question.correctAnswer ?? "")")
                     .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                     .font(.headline)
                     .foregroundStyle(.red)
             }
             .lineSpacing(10)
             
             
         }
         .padding()
         .background(Color.gray.opacity(0.1)) // Light background
         .cornerRadius(10)
         .padding(.horizontal)
     }
 }

//MARK: - ResultTextiPadCellView
struct ResultTextiPadCellView: View {
    
    let question        : ReadingQuestionModel.Question
    let fontSize        = Share.shared.setFontSize()
    let setLineSpacing  = Share.shared.setLineSpacing()
    
     var body: some View {
         // Customize this based on your ResultCollectionViewCell's UI
         VStack(alignment: .leading, spacing: 10) {
             Text("\( question.sections)")
                 .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                 .font(.headline)
                 .padding(.bottom,20)
        
             Text("\( question.question)") // Replace with actual question text
                 .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                 .font(.headline)
                 .lineLimit(nil)
                 .lineSpacing(setLineSpacing)
                 .frame(maxWidth: .infinity, maxHeight: .infinity, alignment: .leading)
                 .padding(.bottom,20)
             VStack(alignment: .leading,spacing: setLineSpacing) {
                 Text("\(question.option_1)") // Display user's answer (handle optional)
                     .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                 Text("\(question.option_2)") // Display user's answer (handle optional)
                     .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                 Text("\(question.option_3)") // Display user's answer (handle optional)
                     .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                 Text("\(question.option_4)") // Display user's answer (handle optional)
                     .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                
                 Text("Correct Answer : \(question.correctAnswer ?? "")")
                     .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                     .font(.headline)
                     .foregroundStyle(.red)
             }
//             .padding()
             
         }
         .padding()
         .background(Color.gray.opacity(0.1)) // Light background
         .cornerRadius(10)
         .padding(.horizontal)
     }
 }

struct HomeButton: View {
    @Environment(\.presentationMode) var presentationMode
    let fontSize = Share.shared.setFontSize()

    var body: some View {
        VStack {
            Button(action: {
                // Dismiss to the root view controller.  This is *much* cleaner in SwiftUI
//                 presentationMode.wrappedValue.dismiss()
                //If you have another VC before firstVC you can use this:
                if let windowScene = UIApplication.shared.connectedScenes.first as? UIWindowScene,
                   let rootVC = windowScene.windows.first?.rootViewController {
                   rootVC.dismiss(animated: true, completion: nil)
                }

            }) {
                Text("Retest")  // Replaced "Ïû¨ÌÖåÏä§Ìä∏" with an English equivalent.
                    .font(.custom("1HoonDdukbokki Regular", size: fontSize))
                    .frame(maxWidth: .infinity)
                    .foregroundColor(.white)
                    .padding()
                    .background(Color.blue) // Set button color
                    .cornerRadius(10)
                
            }
            
        }

        
        .padding()
    }
}

//// MARK: - Preview
//struct ResultView_Previews: PreviewProvider {
//    
//    static var previews: some View {
//        // Create some sample data for the preview
//        let sampleResult = ["3", "5", "60%"]
//        
//        let sampleWrongAnswers: [ReadingQuestionModel.Question] = [
//            ReadingQuestionModel.Question(correctAnswer: "‚ë†  Í∑∏ÎûòÏöî? ÌïúÎ≤à Í∞Ä Î¥êÏïºÍ≤†Ïñ¥Ïöî. ‚úÖ(Ï†ïÎãµ)", option_1: "1 ) Ìï†Î®∏ÎãàÎ•º ÏãúÍ≥®Ïóê ÎëêÍ≥† ÌòºÏûê ÏÑúÏö∏Î°ú Ïò¨ÎùºÏò§Îäî Î∞úÍ±∏ÏùåÏùÄ Í∞ÄÎ≥çÏßÄ ÏïäÏïòÎã§.", option_2: "2 ) Ìï†Î®∏ÎãàÎ•º ÏãúÍ≥®Ïóê ÎëêÍ≥† ÌòºÏûê ÏÑúÏö∏Î°ú Ïò¨ÎùºÏò§Îäî Î∞úÍ±∏ÏùåÏùÄ Í∞ÄÎ≥çÏßÄ ÏïäÏïòÎã§.", option_3: "3 ) Ìï†Î®∏ÎãàÎ•º ÏãúÍ≥®Ïóê ÎëêÍ≥† ÌòºÏûê ÏÑúÏö∏Î°ú Ïò¨ÎùºÏò§Îäî Î∞úÍ±∏ÏùåÏùÄ Í∞ÄÎ≥çÏßÄ ÏïäÏïòÎã§.", option_4: "4 ) Ìï†Î®∏ÎãàÎ•º ÏãúÍ≥®Ïóê ÎëêÍ≥† ÌòºÏûê ÏÑúÏö∏Î°ú Ïò¨ÎùºÏò§Îäî Î∞úÍ±∏ÏùåÏùÄ Í∞ÄÎ≥çÏßÄ ÏïäÏïòÎã§.", question: "Ìï†Î®∏ÎãàÎ•º ÏãúÍ≥®Ïóê ÎëêÍ≥† ÌòºÏûê ÏÑúÏö∏Î°ú Ïò¨ÎùºÏò§Îäî Î∞úÍ±∏ÏùåÏùÄ Í∞ÄÎ≥çÏßÄ ÏïäÏïòÎã§. ÌïòÏßÄÎßå Î¨¥Í±∞Ïõ†Îçò ÎßàÏùåÏùÄ Î©∞Ïπ† Í∞ÄÏßÄ ÏïäÏïòÎã§. Ìï†Î®∏ÎãàÎäî ÎÇ†ÎßàÎã§ Ï†ÑÌôîÎ•º ÌïòÎçîÎãà Í∏âÍ∏∞Ïïº ÏÑúÏö∏Î°ú Ïò¨ÎùºÏò§ÏãúÍ≥† ÎßêÏïòÎã§. Ìï†Î®∏ÎãàÏùò ÏÜêÏûê ÏÇ¨ÎûëÏùÄ Ïñ¥Ï©î Ïàò ÏóÜÎÇò Î≥¥Îã§. Ìï†Î®∏ÎãàÎäî Ï≤≠ÏÜåÎ©∞ Îπ®ÎûòÎ©∞ ÎÇòÏóêÍ≤åÎäî Ïïà Î≥¥Ïù¥Îçò Ïò®Í∞ñ ÏßëÏïàÏùºÎì§ÏùÑ Ï∞æÏïÑÏÑú ÌïòÍ∏∞ ÏãúÏûëÌñàÎã§. Í∑∏ÎÉ• Ïâ¨Îã§Í∞Ä ÎÇ¥Î†§Í∞ÄÏãúÎùºÍ≥† (ÏïÑÎ¨¥Î¶¨ ÎßêÌï¥ÎèÑ Îì§ÏùÄ Ï≤ôÎèÑ ÌïòÏßÄ ÏïäÏïòÎã§). ÏÑúÎ•∏Ïù¥ ÎÑòÏùÄ ÎÇòÎäî Ìï†Î®∏ÎãàÍ∞Ä Î≥¥Í∏∞Ïóî Ïó¨Ï†ÑÌûà ÏïÑÏù¥Ïóê Î∂àÍ≥ºÌñàÎã§. ÏÑúÏö∏ ÏÇ¥Ïù¥ Î™á Ï£º ÎßåÏóê ÎÇØÏÑ† ÎèôÎÑ§ÏóêÏÑú ÏπúÍµ¨ÍπåÏßÄ ÏÇ¨Í∑Ñ Ìï†Î®∏ÎãàÎäî ÏπúÍµ¨Î•º Îî∞Îùº ÏãúÏû•Ïóê Í∞îÎã§Í∞Ä ÎÑòÏñ¥ÏßÄÏãúÍ≥† ÎßêÏïòÎã§. Î≥ëÏõêÏóêÏÑú Ïò® Ïó∞ÎùΩÏùÑ Î∞õÍ≥† Í±±Ï†ïÏù¥ ÎêòÏñ¥ Ï†ïÏã†ÏóÜÏù¥ Îã¨Î†§Í∞îÎçîÎãà Ìï†Î®∏ÎãàÎäî Í∞ôÏùÄ Î≥ëÏã§ ÏÇ¨ÎûåÎì§ÏùÑ Î™®ÏïÑ ÎÜìÍ≥† ÌôòÌïòÍ≤å ÏõÉÏúºÎ©∞ Ïù¥ÏïºÍ∏∞ÌïòÍ≥† ÏûàÏóàÎã§. Îã§Î¶¨Ïóê Î∂ïÎåÄÎ•º Í∞êÍ≥†ÏÑú ÎßêÏù¥Îã§. Í∑∏ Í¥ëÍ≤ΩÏùÑ Î≥¥Í≥† ÎÇú Ìï† ÎßêÏùÑ ÏûÉÏóàÎã§.", sections: "[5~8] (   ) Îã§ÏùåÏùÄ Î¨¥ÏóáÏóê ÎåÄÌïú Í∏ÄÏù∏ÏßÄ Í≥†Î•¥Ïã≠ÏãúÏò§.(Í∞Å 2Ï†ê).", score: "", isImg: "n"),
//            ReadingQuestionModel.Question(correctAnswer: "‚ë†  Í∑∏ÎûòÏöî? ÌïúÎ≤à Í∞Ä Î¥êÏïºÍ≤†Ïñ¥Ïöî. ‚úÖ(Ï†ïÎãµ)", option_1: "1 ) Ìï†Î®∏ÎãàÎ•º ÏãúÍ≥®Ïóê ÎëêÍ≥† ÌòºÏûê ÏÑúÏö∏Î°ú Ïò¨ÎùºÏò§Îäî Î∞úÍ±∏ÏùåÏùÄ Í∞ÄÎ≥çÏßÄ ÏïäÏïòÎã§.", option_2: "2 ) Ìï†Î®∏ÎãàÎ•º ÏãúÍ≥®Ïóê ÎëêÍ≥† ÌòºÏûê ÏÑúÏö∏Î°ú Ïò¨ÎùºÏò§Îäî Î∞úÍ±∏ÏùåÏùÄ Í∞ÄÎ≥çÏßÄ ÏïäÏïòÎã§.", option_3: "3 ) Ìï†Î®∏ÎãàÎ•º ÏãúÍ≥®Ïóê ÎëêÍ≥† ÌòºÏûê ÏÑúÏö∏Î°ú Ïò¨ÎùºÏò§Îäî Î∞úÍ±∏ÏùåÏùÄ Í∞ÄÎ≥çÏßÄ ÏïäÏïòÎã§.", option_4: "4 ) Ìï†Î®∏ÎãàÎ•º ÏãúÍ≥®Ïóê ÎëêÍ≥† ÌòºÏûê ÏÑúÏö∏Î°ú Ïò¨ÎùºÏò§Îäî Î∞úÍ±∏ÏùåÏùÄ Í∞ÄÎ≥çÏßÄ ÏïäÏïòÎã§.", question: "36_9_img", sections: "[5~8] (   ) Îã§ÏùåÏùÄ Î¨¥ÏóáÏóê ÎåÄÌïú Í∏ÄÏù∏ÏßÄ Í≥†Î•¥Ïã≠ÏãúÏò§.(Í∞Å 2Ï†ê).", score: "", isImg: "y")
//        ]
//
//       
//        ResultView(result: sampleResult, wrongAnswerArray: sampleWrongAnswers)
//      
//    }
//}
